# gemggark_backend/docker-compose.yml

version: '3.8' # docker-compose 파일 형식 버전

services:
  # 첫 번째 서비스: 백엔드 API 서버
  gemggark-api:
    build: . # 현재 디렉토리의 Dockerfile을 사용하여 이미지를 빌드합니다.
    ports:
      - "8000:8000" # 내 PC의 8000번 포트와 컨테이너의 8000번 포트를 연결합니다.
    volumes:
      # 로그 파일을 내 PC에서도 확인할 수 있도록 연결합니다. (선택 사항)
      - ./gemggark_api.log:/app/gemggark_api.log
    env_file:
      - ./.env # .env 파일의 환경 변수를 컨테이너에 전달합니다.
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu] # 컨테이너가 GPU를 사용하도록 설정합니다.
    depends_on:
      - redis # redis 서비스가 시작된 후에 이 서비스가 시작되도록 합니다.

  # 두 번째 서비스: Redis 캐시 데이터베이스
  redis:
    image: "redis:alpine" # Docker Hub에서 공식 Redis 이미지를 가져옵니다.
    ports:
      - "6379:6379" # Redis 기본 포트를 연결합니다. (디버깅용)
